<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-VCHLZ9M2NG"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-VCHLZ9M2NG');
    </script>
    <title>化学课程 - 交互式学习系统</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <h1>🧪 化学课程</h1>
            </div>
            <ul class="nav-links">
                <li><a href="#home" onclick="showSection('home')">首页</a></li>
                <li><a href="#atomic-world" onclick="showSection('atomic-world')">原子世界</a></li>
                <li><a href="#chemical-bonds" onclick="showSection('chemical-bonds')">化学键</a></li>
                <li><a href="#reactions" onclick="showSection('reactions')">反应原理</a></li>
                <li><a href="#elements" onclick="showSection('elements')">元素王国</a></li>
                <li><button id="stats-btn" class="stats-btn" onclick="showStatsModal()">📊 学习档案</button></li>
            </ul>
        </div>
    </nav>

    <!-- 首页 -->
    <section id="home" class="section active">
        <div class="hero-section">
            <div class="hero-content">
                <h1>探索化学的奇妙世界</h1>
                <p class="hero-description">
                    从微观原子到宏观物质，从简单反应到复杂变化<br>
                    让我们一起揭开化学的神秘面纱
                </p>
                <div class="hero-stats">
                    <div class="stat-item">
                        <div class="stat-number">4</div>
                        <div class="stat-label">核心章节</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">交互模型</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number">100+</div>
                        <div class="stat-label">化学概念</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 课程框架网格 -->
        <div class="framework-grid">
            <div class="framework-card" onclick="showSection('atomic-world')">
                <div class="card-icon">⚛️</div>
                <h3>第一章：原子世界</h3>
                <p>探索构成万物的基本粒子，了解原子结构、电子排布和元素周期律</p>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                    <span>100% 完成</span>
                </div>
            </div>

            <div class="framework-card" onclick="showSection('chemical-bonds')">
                <div class="card-icon">🔗</div>
                <h3>第二章：化学键</h3>
                <p>学习离子键、共价键、金属键的形成原理和分子几何构型</p>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                    <span>100% 完成</span>
                </div>
            </div>

            <div class="framework-card" onclick="showSection('reactions')">
                <div class="card-icon">⚡</div>
                <h3>第三章：反应原理</h3>
                <p>掌握化学反应类型、能量变化、反应速率和化学平衡原理</p>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                    <span>100% 完成</span>
                </div>
            </div>

            <div class="framework-card" onclick="showSection('elements')">
                <div class="card-icon">👑</div>
                <h3>第四章：元素王国</h3>
                <p>认识金属、非金属元素家族，了解有机化学基础和应用</p>
                <div class="card-progress">
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: 100%"></div>
                    </div>
                    <span>100% 完成</span>
                </div>
            </div>
        </div>

        <!-- 数学公式示例 -->
        <div class="math-example">
            <h3>化学中的数学之美</h3>
            <div class="formula-grid">
                <div class="formula-item">
                    <div class="formula">$$E = mc^2$$</div>
                    <p>质能方程</p>
                </div>
                <div class="formula-item">
                    <div class="formula">$$PV = nRT$$</div>
                    <p>理想气体状态方程</p>
                </div>
                <div class="formula-item">
                    <div class="formula">$$\Delta G = \Delta H - T\Delta S$$</div>
                    <p>吉布斯自由能</p>
                </div>
            </div>
        </div>

    </section>

    <!-- 原子世界部分 -->
    <section id="atomic-world" class="section">
        <div class="chapter-header">
            <h2>第一章：原子世界</h2>
            <p class="chapter-description">探索构成万物的基本粒子</p>
        </div>

        <div class="content-grid">
            <div class="text-content">
                <h3>🧩 原子结构</h3>
                <p>原子是化学变化中的最小粒子，由原子核和核外电子构成：</p>
                <ul>
                    <li><strong>质子</strong>：带正电，决定元素种类</li>
                    <li><strong>中子</strong>：不带电，影响原子质量</li>
                    <li><strong>电子</strong>：带负电，决定化学性质</li>
                </ul>

                <div class="formula-card">
                    <div class="formula-title">原子构成公式</div>
                    <div class="formula">$$原子序数 = 质子数 = 核外电子数$$</div>
                    <div class="formula">$$质量数 = 质子数 + 中子数$$</div>
                </div>

                <h4>同位素概念</h4>
                <p>具有相同质子数、不同中子数的同一元素的不同原子互称为同位素。</p>
                <div class="example">
                    <strong>示例：</strong>氢的三种同位素：氕(H)、氘(D)、氚(T)
                </div>
            </div>

            <div class="visual-content">
                <div class="interactive-model">
                    <h4>原子结构交互模型</h4>
                <div class="model-controls">
                    <label for="element-select">选择元素：</label>
                    <select id="element-select" onchange="updateAtomModel(this.value)">
                        <option value="H">氢 (H)</option>
                        <option value="He">氦 (He)</option>
                        <option value="Li" selected>锂 (Li)</option>
                        <option value="Be">铍 (Be)</option>
                        <option value="B">硼 (B)</option>
                        <option value="C">碳 (C)</option>
                        <option value="N">氮 (N)</option>
                        <option value="O">氧 (O)</option>
                        <option value="F">氟 (F)</option>
                        <option value="Ne">氖 (Ne)</option>
                        <option value="Na">钠 (Na)</option>
                        <option value="Mg">镁 (Mg)</option>
                        <option value="Al">铝 (Al)</option>
                        <option value="Si">硅 (Si)</option>
                        <option value="P">磷 (P)</option>
                        <option value="S">硫 (S)</option>
                        <option value="Cl">氯 (Cl)</option>
                        <option value="Ar">氩 (Ar)</option>
                        <option value="K">钾 (K)</option>
                        <option value="Ca">钙 (Ca)</option>
                        <option value="Sc">钪 (Sc)</option>
                        <option value="Ti">钛 (Ti)</option>
                        <option value="V">钒 (V)</option>
                        <option value="Cr">铬 (Cr)</option>
                        <option value="Mn">锰 (Mn)</option>
                        <option value="Fe">铁 (Fe)</option>
                        <option value="Co">钴 (Co)</option>
                        <option value="Ni">镍 (Ni)</option>
                        <option value="Cu">铜 (Cu)</option>
                        <option value="Zn">锌 (Zn)</option>
                        <option value="Ga">镓 (Ga)</option>
                        <option value="Ge">锗 (Ge)</option>
                        <option value="As">砷 (As)</option>
                        <option value="Se">硒 (Se)</option>
                        <option value="Br">溴 (Br)</option>
                        <option value="Kr">氪 (Kr)</option>
                    </select>
                </div>
                    <div id="atom-model" class="atom-model">
                        <!-- 原子模型将通过JavaScript动态生成 -->
                    </div>
                    <div id="atom-info" class="atom-info">
                        <!-- 元素信息将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 电子排布部分 -->
        <div class="content-grid">
            <div class="visual-content">
                <div class="electron-configuration">
                    <h4>电子排布规律</h4>
                    <div class="electron-shells">
                        <div class="shell" data-shell="K">K层 (最多2e⁻)</div>
                        <div class="shell" data-shell="L">L层 (最多8e⁻)</div>
                        <div class="shell" data-shell="M">M层 (最多18e⁻)</div>
                        <div class="shell" data-shell="N">N层 (最多32e⁻)</div>
                    </div>
                    <div class="filling-rules">
                        <h5>填充规则：</h5>
                        <ul>
                            <li>能量最低原理</li>
                            <li>泡利不相容原理</li>
                            <li>洪特规则</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="text-content">
                <h3>⚡ 电子排布</h3>
                <p>核外电子按照特定规则分层排布：</p>

                <div class="principle-card">
                    <h5>能量最低原理</h5>
                    <p>电子优先占据能量较低的轨道</p>
                </div>

                <div class="principle-card">
                    <h5>泡利不相容原理</h5>
                    <p>同一轨道最多容纳2个自旋方向相反的电子</p>
                </div>

                <div class="principle-card">
                    <h5>洪特规则</h5>
                    <p>电子在等价轨道上尽可能分占不同轨道且自旋平行</p>
                </div>
            </div>
        </div>

        <!-- 元素周期表部分 -->
        <div class="periodic-table-section">
            <h3>🗺️ 元素周期表 - 化学的"地图"</h3>

            <div class="periodic-table-intro">
                <div class="pt-info">
                    <h4>周期表规律</h4>
                    <ul>
                        <li><strong>周期</strong>：电子层数相同，从左到右金属性减弱</li>
                        <li><strong>族</strong>：最外层电子数相同，化学性质相似</li>
                        <li><strong>分区</strong>：s区、p区、d区、f区</li>
                    </ul>
                </div>
                <div class="pt-preview" id="pt-preview">
                    <!-- 简化周期表将通过JavaScript生成 -->
                </div>
            </div>

            <div class="trends">
                <h4>周期性变化规律</h4>
                <div class="trend-grid">
                    <div class="trend-item">
                        <h5>原子半径</h5>
                        <p>同周期↘，同主族↗</p>
                    </div>
                    <div class="trend-item">
                        <h5>金属性</h5>
                        <p>同周期↘，同主族↗</p>
                    </div>
                    <div class="trend-item">
                        <h5>电负性</h5>
                        <p>同周期↗，同主族↘</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- 元素性质对比表格 -->
        <div class="element-comparison">
            <h3>📊 元素性质对比</h3>
            <div class="comparison-table-container">
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>元素</th>
                            <th>原子序数</th>
                            <th>相对原子质量</th>
                            <th>电子排布</th>
                            <th>元素类别</th>
                            <th>电负性</th>
                        </tr>
                    </thead>
                    <tbody id="comparison-table-body">
                        <!-- 表格数据将通过JavaScript动态生成 -->
                    </tbody>
                </table>
            </div>
            <div class="comparison-notes">
                <p><strong>说明：</strong>电负性数值越大，表示原子吸引电子的能力越强。氟(F)是电负性最强的元素。</p>
            </div>
        </div>
    </section>

    <!-- 化学键章节 -->
    <section id="chemical-bonds" class="section">
        <!-- 内容将通过模块加载器动态加载 -->
    </section>

    <!-- 反应原理章节 -->
    <section id="reactions" class="section">
        <!-- 内容将通过模块加载器动态加载 -->
    </section>

    <!-- 元素王国章节 - 动态加载 -->
    <section id="elements" class="section">
        <!-- 内容将通过模块加载器动态加载 -->
    </section>

    <script src="core/shared/utils.js"></script>
    <script src="core/shared/constants.js"></script>
    <script src="core/shared/analytics.js"></script>
    <script src="core/core.js?v=1.0.0"></script>
    <!-- 学习统计模态框 -->
    <div id="stats-modal" class="stats-modal">
        <div class="stats-modal-content">
            <div class="stats-modal-header">
                <h2>📊 我的学习档案</h2>
                <button class="stats-modal-close" onclick="closeStatsModal()">×</button>
            </div>
            <div class="stats-modal-body">
                <div class="stats-section">
                    <h3>访客身份</h3>
                    <div class="stats-card">
                        <div class="stats-row">
                            <span class="stats-label">访客ID：</span>
                            <span id="stats-user-id" class="stats-value">加载中...</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">首次访问：</span>
                            <span id="stats-first-visit" class="stats-value">加载中...</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">最近访问：</span>
                            <span id="stats-last-visit" class="stats-value">加载中...</span>
                        </div>
                        <div class="stats-row">
                            <span class="stats-label">总访问次数：</span>
                            <span id="stats-total-visits" class="stats-value">加载中...</span>
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <h3>学习时长统计</h3>
                    <div class="stats-card">
                        <div class="stats-row">
                            <span class="stats-label">总学习时长：</span>
                            <span id="stats-total-time" class="stats-value highlight">加载中...</span>
                        </div>
                        <div class="stats-chart" id="stats-chart">
                            <!-- 柱状图将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>

                <div class="stats-section">
                    <h3>各章节学习情况</h3>
                    <div class="stats-card">
                        <div id="stats-chapters-list" class="stats-chapters-list">
                            <!-- 章节列表将通过JavaScript动态生成 -->
                        </div>
                    </div>
                </div>

                <div class="stats-actions">
                    <button class="stats-btn-secondary" onclick="resetStatsData()">🔄 重置学习数据</button>
                    <button class="stats-btn-secondary" onclick="refreshStats()">🔄 刷新数据</button>
                </div>

                <div class="stats-note">
                    <p>💡 提示：所有数据仅存储在您的浏览器本地，不会上传到任何服务器。</p>
                </div>
            </div>
        </div>
    </div>

    <!-- 统计模态框相关脚本 -->
    <script>
        // 显示统计模态框
        function showStatsModal() {
            const modal = document.getElementById('stats-modal');
            if (modal) {
                modal.style.display = 'flex';
                refreshStats(); // 打开时刷新数据
            }
        }

        // 关闭统计模态框
        function closeStatsModal() {
            const modal = document.getElementById('stats-modal');
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // 点击模态框外部关闭
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('stats-modal');
            if (event.target === modal) {
                closeStatsModal();
            }
        });

        // 刷新统计数据
        function refreshStats() {
            if (!window.Analytics) {
                console.warn('Analytics模块未加载');
                return;
            }

            const stats = Analytics.getStats();
            if (!stats) {
                console.warn('无法获取统计数据');
                return;
            }

            // 更新基本信息
            document.getElementById('stats-user-id').textContent = stats.userId || '未知';
            document.getElementById('stats-first-visit').textContent = 
                stats.firstVisit ? new Date(stats.firstVisit).toLocaleString('zh-CN') : '未知';
            document.getElementById('stats-last-visit').textContent = 
                stats.lastVisit ? new Date(stats.lastVisit).toLocaleString('zh-CN') : '未知';
            document.getElementById('stats-total-visits').textContent = stats.totalVisits || 0;
            document.getElementById('stats-total-time').textContent = stats.formattedTotalTime || '0分钟';

            // 生成章节柱状图
            renderStatsChart(stats.chapters);

            // 生成章节列表
            renderChaptersList(stats.chapters);
        }

        // 渲染统计柱状图
        function renderStatsChart(chapters) {
            const chartContainer = document.getElementById('stats-chart');
            if (!chartContainer) return;

            // 清除现有内容
            chartContainer.innerHTML = '';

            // 找到最大时间用于比例计算
            const maxTime = Math.max(...Object.values(chapters).map(c => c.time), 1);
            const chapterNames = {
                'home': '首页',
                'atomic-world': '原子世界',
                'chemical-bonds': '化学键',
                'reactions': '反应原理',
                'elements': '元素王国'
            };

            // 创建柱状图
            Object.entries(chapters).forEach(([chapterId, data]) => {
                if (!data || data.time === undefined) return;

                const barContainer = document.createElement('div');
                barContainer.className = 'stats-bar-container';

                const barLabel = document.createElement('div');
                barLabel.className = 'stats-bar-label';
                barLabel.textContent = chapterNames[chapterId] || chapterId;

                const barWrapper = document.createElement('div');
                barWrapper.className = 'stats-bar-wrapper';

                const bar = document.createElement('div');
                bar.className = 'stats-bar';
                bar.style.width = `${(data.time / maxTime) * 100}%`;

                const barValue = document.createElement('div');
                barValue.className = 'stats-bar-value';
                barValue.textContent = formatTimeShort(data.time);

                barWrapper.appendChild(bar);
                barWrapper.appendChild(barValue);
                barContainer.appendChild(barLabel);
                barContainer.appendChild(barWrapper);
                chartContainer.appendChild(barContainer);
            });
        }

        // 渲染章节列表
        function renderChaptersList(chapters) {
            const listContainer = document.getElementById('stats-chapters-list');
            if (!listContainer) return;

            // 清除现有内容
            listContainer.innerHTML = '';

            const chapterNames = {
                'home': '首页',
                'atomic-world': '原子世界',
                'chemical-bonds': '化学键',
                'reactions': '反应原理',
                'elements': '元素王国'
            };

            Object.entries(chapters).forEach(([chapterId, data]) => {
                if (!data) return;

                const listItem = document.createElement('div');
                listItem.className = 'stats-chapter-item';

                const chapterName = document.createElement('span');
                chapterName.className = 'stats-chapter-name';
                chapterName.textContent = chapterNames[chapterId] || chapterId;

                const chapterStats = document.createElement('span');
                chapterStats.className = 'stats-chapter-stats';
                chapterStats.textContent = `${formatTimeShort(data.time)} (访问${data.visits}次)`;

                listItem.appendChild(chapterName);
                listItem.appendChild(chapterStats);
                listContainer.appendChild(listItem);
            });
        }

        // 格式化时间（简短版）
        function formatTimeShort(seconds) {
            if (seconds < 60) {
                return `${seconds}秒`;
            } else if (seconds < 3600) {
                return `${Math.floor(seconds / 60)}分钟`;
            } else {
                const hours = Math.floor(seconds / 3600);
                const minutes = Math.floor((seconds % 3600) / 60);
                return `${hours}小时${minutes}分钟`;
            }
        }

        // 重置统计数据
        function resetStatsData() {
            if (!window.Analytics) {
                alert('Analytics模块未加载');
                return;
            }

            if (confirm('确定要重置所有学习数据吗？此操作不可撤销。')) {
                Analytics.resetData();
                refreshStats();
                alert('学习数据已重置！');
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 确保Analytics已初始化
            setTimeout(refreshStats, 1000);
        });
    </script>
</body>
</html>
